



知识点4 股票价格的拟合
P1 同学好，本节课讲解股票价格的拟合案例。
P2（停留2s）
本次课程内容为股票价格的拟合，注意这个编程代码不是注重股票预测，而是注重案例本身体现的课程知识。我们先看这组数据，数据来源为公开网络，数据存储在Excel表格中，我们观察一下数据的形式，首先600519表示茅台酒的股票代码，数据从2010年4月至2020年4月之间的股票信息数据，有2000个数据。具体包含的信息内容可以看表格的列，open开盘价，close收盘价，最高价，最低价，成交数等信息。本次实验的内容重点关注的是open开盘价的信息，根据开盘价拟合股票的价格趋势，实验的目的是用这些数据来进行验证学习内容，如何用循环神经网络来做拟合呢？我们先看一下代码。第一步要导入必要的库，要掌握常用库的作用。数据格式为Excel表，在Python中如何读入呢？需要用到pandas模块，专门用来处理表格数据的，可以处理累加、透视图等工作。第二步导入本地的csv文件，也就是读取股票信息文件，将读入的内容进行训练集的分割（training set），iloc函数的作用是将2126天的开盘价作为训练集，表格从0开始计数，提取2、3列的内容，由于使用了开闭区间括号对2、3列做了限制，因此这个位置只提取了第2列内容，也就是开盘价格信息。剩余的300个数据作为测试集，为了减低数据突然变化的影响，采用了数学上的归一化操作方法，并生成数据集。是根据simpleRNN的形状、输入要求对数据进行整理。这里的时间步是怎么定义的呢？使用60天，相当于时间步就是60，来预测第61天的股票价格，以此类推。每隔60天进行预测一次，因此训练的样本数据共有2066组。接下来要把训练集的list格式变为array格式，也就是张量格式。Reshape函数中的参数0，代表第一维，也就是样本数量，时间展开步数为60，每次时间步的维度特征是1，代表价格。代码中使用了两次simple RNN，第一个要求输出每一个时间步，值为Ture，提取多层时间维度的特征。第二个因为要连接全连接层，值设置为默认的False，其中全连接层为1表示输出的只有1个预测信息，即开盘价格。dropout的作用是减少过拟合问题。下面运行一下结果，这里训练了50轮，由于数据量较大，需要一定的训练时间。实训结束后，我们看一下绘制的图形内容，红色曲线为原始数据绘制的曲线，蓝色曲线为预测值曲线，可以看出曲线的基本形状是相近的，稍微有一些误差，对于股票信息我们不需要了解非常准确的价格信息，重点是要明确价格变化的趋势，这样便于操盘分析。这个实验说明通过循环神经网络可以比较准确的拟合时间序列内容，对于像股票这种时间连续分析的案例比较适用。
P3 本单元主要通过案例巩固循环神经网络知识，通过两个例子解释了循环计算的操作方法；通过股票价格案例分析了循环神经网络训练的实现方法等内容。
到本次课为止，所有循环神经网络的内容都讲解完毕，请同学课后认真做习题、认真复习本章内容。