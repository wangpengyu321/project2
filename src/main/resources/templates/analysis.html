<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">关系分析 - 大数据知识图谱系统</title>
    
    <!-- 引入样式库 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary-color: #4cc9f0;
            --accent-color: #f72585;
            --warning-color: #ffd166;
            --success-color: #06d6a0;
            --danger-color: #ef476f;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --sidebar-width: 260px;
            --sidebar-width-collapsed: 70px;
            --topbar-height: 60px;
            --card-border-radius: 10px;
            --transition-speed: 0.3s;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
        }

        /* 基础样式 */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fb;
            color: var(--gray-800);
            overflow-x: hidden;
            margin: 0;
            position: relative;
            min-height: 100vh;
        }

        /* 装饰效果 */
        .deco-shape {
            position: fixed;
            border-radius: 50%;
            z-index: -1;
            filter: blur(70px);
            opacity: 0.25;
        }

        .deco-shape-1 {
            width: 400px;
            height: 400px;
            background: var(--primary-light);
            top: -200px;
            right: -200px;
        }

        .deco-shape-2 {
            width: 300px;
            height: 300px;
            background: var(--secondary-color);
            bottom: -150px;
            left: -150px;
        }

        /* 侧边栏样式 */
        .sidebar {
            position: fixed;
            width: var(--sidebar-width);
            height: 100vh;
            background: white;
            box-shadow: var(--box-shadow);
            z-index: 1000;
            transition: all var(--transition-speed) ease;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        .sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--gray-200);
        }

        .sidebar-header h3 {
            font-size: 1.2rem;
            margin: 0;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header h3 i {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .sidebar.collapsed .sidebar-header h3 {
            display: none;
        }

        .sidebar-menu {
            padding: 15px 0;
        }

        .menu-section {
            margin-bottom: 20px;
        }

        .menu-section-title {
            padding: 10px 20px;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--gray-600);
            font-weight: 500;
        }

        .sidebar.collapsed .menu-section-title {
            display: none;
        }

        .menu-item {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray-700);
            text-decoration: none;
            transition: all var(--transition-speed) ease;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--gray-100);
            color: var(--primary-color);
        }

        .menu-item.active {
            background-color: var(--gray-100);
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
            font-weight: 500;
        }

        .menu-item i {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .menu-item {
            justify-content: center;
            padding: 15px 0;
        }

        .sidebar.collapsed .menu-item span {
            display: none;
        }

        /* 主内容区域样式 */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: all var(--transition-speed) ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content.expanded {
            margin-left: var(--sidebar-width-collapsed);
        }

        /* 顶部导航栏样式 */
        .top-navbar {
            height: var(--topbar-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar-title h4 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .toggle-sidebar {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-600);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all var(--transition-speed) ease;
        }

        .toggle-sidebar:hover {
            background-color: var(--gray-100);
            color: var(--primary-color);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            color: var(--gray-600);
            position: relative;
        }

        .nav-icon-btn:hover {
            background-color: var(--gray-100);
            color: var(--primary-color);
        }

        .nav-icon-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.6rem;
            padding: 3px 6px;
        }

        .user-dropdown {
            position: relative;
        }

        .dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            color: var(--gray-700);
            font-weight: 500;
            border-radius: 8px;
            transition: all var(--transition-speed) ease;
        }

        .dropdown-toggle:hover {
            background-color: var(--gray-100);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .dropdown-menu {
            border: none;
            box-shadow: var(--box-shadow);
            border-radius: var(--card-border-radius);
            padding: 8px 0;
            min-width: 200px;
        }

        .dropdown-header {
            padding: 10px 20px;
        }

        .dropdown-item {
            padding: 8px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-speed) ease;
        }

        .dropdown-item i {
            font-size: 1rem;
        }

        .dropdown-item:hover {
            background-color: var(--gray-100);
            color: var(--primary-color);
        }

        /* 内容区域样式 */
        .content {
            flex: 1;
            padding: 20px;
        }

        .dashboard-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 5px;
        }

        .dashboard-subtitle {
            color: var(--gray-600);
            margin-bottom: 20px;
        }

        /* 关系分析页面特有样式 */
        .selection-card, .result-summary-card {
            border: none;
            border-radius: var(--card-border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        .card-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 15px;
        }
        
        .form-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 5px;
        }
        
        .relation-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .range-value {
            background-color: var(--gray-200);
            color: var(--gray-700);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            min-width: 30px;
            text-align: center;
        }
        
        /* 结果部分样式 */
        .result-summary-content {
            margin-top: 20px;
        }
        
        .summary-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--gray-700);
        }
        
        .summary-text p {
            margin-bottom: 10px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            background-color: var(--gray-100);
            border-radius: var(--card-border-radius);
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray-600);
        }
        
        /* 可视化部分 */
        .visualization-container {
            position: relative;
            min-height: 500px;
            background-color: #f8fafe;
        }
        
        .visualization-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .viz-title {
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .viz-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .viz-control-btn {
            width: 32px;
            height: 32px;
            border: none;
            background-color: var(--gray-100);
            color: var(--gray-700);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }
        
        .viz-control-btn:hover {
            background-color: var(--gray-200);
            color: var(--primary-color);
        }
        
        .viz-view-switch {
            display: flex;
            margin-left: 10px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .viz-view-btn {
            border: none;
            background-color: var(--gray-100);
            color: var(--gray-700);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }
        
        .viz-view-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .visualization-graph {
            height: 500px;
            width: 100%;
        }
        
        .path-selector {
            display: flex;
            gap: 15px;
            padding: 15px 20px;
            border-top: 1px solid var(--gray-200);
            background-color: white;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .path-selector-label {
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .path-option {
            padding: 6px 12px;
            background-color: var(--gray-100);
            border-radius: 20px;
            color: var(--gray-700);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }
        
        .path-option.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* 路径详情 */
        .path-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .path-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        .path-title h6 {
            font-weight: 600;
            margin: 0;
        }
        
        .path-meta {
            display: flex;
            gap: 10px;
        }
        
        .path-length, .path-difficulty {
            background-color: var(--gray-100);
            color: var(--gray-700);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
        }
        
        .path-steps {
            margin-bottom: 25px;
        }
        
        .path-step {
            margin-bottom: 15px;
            position: relative;
        }
        
        .step-node {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: var(--gray-100);
            padding: 12px 15px;
            border-radius: 8px;
            position: relative;
        }
        
        .start-node {
            background-color: rgba(67, 97, 238, 0.1);
            border-left: 3px solid var(--primary-color);
        }
        
        .end-node {
            background-color: rgba(76, 201, 240, 0.1);
            border-left: 3px solid var(--secondary-color);
        }
        
        .node-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .node-content {
            flex: 1;
        }
        
        .node-title {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .node-desc {
            color: var(--gray-600);
            font-size: 0.85rem;
        }
        
        .step-connector {
            position: relative;
            margin-top: 8px;
            margin-bottom: 8px;
            padding-left: 55px;
            height: 30px;
        }
        
        .connector-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--gray-300);
        }
        
        .connector-label {
            display: inline-block;
            background-color: var(--gray-200);
            color: var(--gray-700);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        
        .path-recommendation {
            background-color: var(--gray-100);
            border-radius: 8px;
            padding: 15px;
        }
        
        .recommendation-header {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        
        .recommendation-content {
            font-size: 0.9rem;
            color: var(--gray-700);
            margin-bottom: 15px;
        }
        
        .recommendation-content p {
            margin-bottom: 8px;
        }
        
        .resource-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .resource-link:hover {
            text-decoration: underline;
        }
        
        /* 关联知识点列表 */
        .related-nodes-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .related-node-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 15px;
            background-color: var(--gray-100);
            border-radius: 8px;
            transition: all var(--transition-speed) ease;
        }
        
        .related-node-item:hover {
            transform: translateX(5px);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .related-node-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .related-node-content {
            flex: 1;
        }
        
        .related-node-title {
            display: flex;
            justify-content: space-between;
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .relatedness {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .related-node-meta {
            display: flex;
            gap: 10px;
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        .node-type, .node-chapter {
            position: relative;
        }
        
        .node-type:after {
            content: "•";
            margin-left: 5px;
        }
        
        /* 初始状态卡片 */
        .analysis-feature-card {
            background-color: white;
            border-radius: var(--card-border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            height: 100%;
            transition: all var(--transition-speed) ease;
            text-align: center;
        }
        
        .analysis-feature-card:hover {
            box-shadow: var(--box-shadow-hover);
            transform: translateY(-5px);
        }
        
        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
        }
        
        .analysis-feature-card:nth-child(2) .feature-icon {
            background-color: var(--secondary-color);
        }
        
        .analysis-feature-card:nth-child(3) .feature-icon {
            background-color: var(--accent-color);
        }
        
        .analysis-feature-card h5 {
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .analysis-feature-card p {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        /* 节点选择模态框 */
        .modal-search {
            position: relative;
        }
        
        .node-tabs {
            margin-top: 10px;
        }
        
        .node-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
        }
        
        .node-card {
            padding: 10px;
            background-color: var(--gray-100);
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }
        
        .node-card:hover, .node-card.selected {
            background-color: rgba(67, 97, 238, 0.1);
            transform: translateY(-2px);
        }
        
        .node-card.selected {
            border: 1px solid var(--primary-color);
        }
        
        .node-card-title {
            font-weight: 500;
            margin-bottom: 3px;
            color: var(--gray-800);
        }
        
        .node-card-type {
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        /* AI助手样式 */
        .chat-message {
            margin-bottom: 15px;
        }
        
        .message-content {
            background-color: white;
            border-radius: 15px;
            max-width: 85%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .ai-message .message-content {
            border-bottom-left-radius: 5px;
        }
        
        .user-message .message-content {
            border-bottom-right-radius: 5px;
            margin-left: auto;
        }
        
        .user-message small {
            display: block;
            text-align: right;
        }
        
        /* 响应式样式 */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.collapsed {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .top-navbar {
                left: 0;
            }
        }
        
        @media (max-width: 768px) {
            .card-body {
                padding: 15px;
            }
        }
        
        /* 消息通知下拉菜单 */
        .notification-dropdown {
            width: 300px;
            padding: 0;
            max-height: 350px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }
        
        .notification-content {
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .nav-icon-btn-inner {
            background: none;
            border: none;
            width: 100%;
            height: 100%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: inherit;
        }

        /* 知识图谱分析新增样式 */
        .section-header {
            margin-bottom: 1.5rem;
        }
        
        .section-header h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .section-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .analysis-toolbar {
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--card-border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
        }
        
        .visualization-canvas {
            height: 600px;
            width: 100%;
            background-color: #f8f9fa;
            border-radius: 0 0 var(--card-border-radius) var(--card-border-radius);
            position: relative;
        }
        
        .analysis-info {
            min-height: 400px;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .result-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .summary-item {
            flex: 1;
            min-width: 120px;
            background-color: var(--gray-100);
            padding: 0.8rem;
            border-radius: 8px;
        }
        
        .summary-label {
            display: block;
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-bottom: 0.2rem;
        }
        
        .summary-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* 路径步骤 */
        .path-steps {
            margin-top: 1.5rem;
        }
        
        .path-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .step-number {
            width: 28px;
            height: 28px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .step-content {
            margin-left: 1rem;
            padding: 0.5rem 0;
        }
        
        .step-title {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .step-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* 关系统计 */
        .relation-stats {
            padding: 0;
        }
        
        .stat-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.2rem;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        /* 聚类可视化 */
        .clustering-visualization {
            height: 400px;
            background-color: #f8f9fa;
            border-radius: var(--card-border-radius);
            margin-bottom: 1rem;
        }
        
        /* 聚类信息 */
        .cluster-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .cluster-item {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            margin-bottom: 0.8rem;
            overflow: hidden;
        }
        
        .cluster-item.active {
            border-color: var(--primary-color);
        }
        
        .cluster-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1rem;
            background-color: var(--gray-100);
            cursor: pointer;
        }
        
        .cluster-title {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .cluster-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        
        .cluster-title h6 {
            margin: 0;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .cluster-count {
            font-size: 0.8rem;
            color: var(--gray-600);
        }
        
        .cluster-content {
            padding: 0.8rem 1rem;
        }
        
        .cluster-nodes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .cluster-nodes span {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            background-color: var(--gray-200);
            border-radius: 15px;
            font-size: 0.8rem;
            color: var(--text-primary);
        }
        
        .actions-row {
            display: flex;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- 装饰形状 -->
    <div class="deco-shape deco-shape-1"></div>
    <div class="deco-shape deco-shape-2"></div>
    
    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3><i class="bi bi-diagram-3-fill"></i> 大数据知识图谱</h3>
            <i class="bi bi-x-lg d-lg-none" id="close-sidebar" style="cursor: pointer;"></i>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-title">主要功能</div>
                <a href="/aigraph/dashboard" class="menu-item">
                    <i class="bi bi-speedometer2"></i>仪表盘
                </a>
                <a href="/aigraph/graph-view" class="menu-item">
                    <i class="bi bi-graph-up"></i>知识图谱
                </a>
                <a href="/aigraph/search" class="menu-item">
                    <i class="bi bi-search"></i>知识检索
                </a>
                <a href="/aigraph/analysis" class="menu-item active">
                    <i class="bi bi-diagram-3"></i>关系分析
                </a>
                <a href="/aigraph/visualization" class="menu-item">
                    <i class="bi bi-bar-chart-line"></i>数据可视化
                </a>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-title">学习资源</div>
                <a href="/aigraph/courses" class="menu-item">
                    <i class="bi bi-journal-text"></i>课程内容
                </a>
                <a href="/aigraph/qa" class="menu-item">
                    <i class="bi bi-robot"></i>AI智能问答
                </a>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-title">系统管理</div>
                <a href="/aigraph/settings" class="menu-item">
                    <i class="bi bi-gear"></i>系统设置
                </a>
                <a href="/aigraph/profile" class="menu-item">
                    <i class="bi bi-person"></i>个人中心
                </a>
                <a href="/aigraph/logout" class="menu-item">
                    <i class="bi bi-box-arrow-right"></i>退出登录
                </a>
            </div>
        </div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="main-content" id="main-content">
        <!-- 顶部导航栏 -->
        <div class="top-navbar">
            <!-- 标题 -->
            <div class="navbar-title">
                <h4>关系分析</h4>
            </div>
            
            <div class="navbar-right">
                <div class="nav-icon-btn" title="消息通知">
                    <i class="bi bi-bell"></i>
                    <span class="badge bg-danger">3</span>
                </div>
                
                <div class="user-dropdown dropdown">
                    <button class="dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="user-avatar" th:text="${#strings.substring(username, 0, 1).toUpperCase()}">A</div>
                        <span th:text="${username}">用户名</span>
                        <i class="bi bi-chevron-down ms-2"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li>
                            <div class="dropdown-header">
                                <strong th:text="${username}">用户名</strong>
                                <p class="mb-0">管理员</p>
                            </div>
                        </li>
                        <li><a class="dropdown-item" href="/aigraph/profile" id="profileLink"><i class="bi bi-person"></i> 个人资料</a></li>
                        <li><a class="dropdown-item" href="/aigraph/settings" id="settingsLink"><i class="bi bi-gear"></i> 账号设置</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="/aigraph/logout"><i class="bi bi-box-arrow-right"></i> 退出登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content">
            <div class="container-fluid">
                <!-- 页面标题 -->
                <div class="section-header">
                    <h2>知识关系分析</h2>
                    <p>深入分析《大数据技术》课程知识点之间的关联关系，发现知识结构和学习路径</p>
                </div>
                
                <!-- 分析工具栏 -->
                <div class="analysis-toolbar">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label for="startNode" class="form-label">起始知识点</label>
                            <select class="form-select" id="startNode">
                                <option value="">选择起始知识点...</option>
                                <option value="node1">大数据概述</option>
                                <option value="node2">数据采集基础</option>
                                <option value="node3">分布式存储</option>
                                <option value="node4">数据处理</option>
                                <option value="node7">MapReduce模型</option>
                                <option value="node9">分布式计算</option>
                                <option value="node14">数据质量管理</option>
                                <option value="node18">Hadoop框架</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="endNode" class="form-label">目标知识点</label>
                            <select class="form-select" id="endNode">
                                <option value="">选择目标知识点...</option>
                                <option value="node9">分布式计算</option>
                                <option value="node10">Spark框架</option>
                                <option value="node11">数据仓库</option>
                                <option value="node12">数据湖</option>
                                <option value="node13">ETL流程</option>
                                <option value="node19">数据挖掘</option>
                                <option value="node20">数据可视化</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="analysisType" class="form-label">分析类型</label>
                            <select class="form-select" id="analysisType">
                                <option value="path">学习路径分析</option>
                                <option value="dependency">依赖关系分析</option>
                                <option value="similarity">相似度分析</option>
                                <option value="cluster">知识聚类分析</option>
                                <option value="centrality">中心性分析</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12 d-flex justify-content-end">
                            <button class="btn btn-primary" id="runAnalysisBtn">
                                <i class="bi bi-play-fill me-1"></i> 运行分析
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 分析结果展示区域 -->
                <div class="analysis-results">
                    <div class="row">
                        <!-- 左侧：图谱可视化 -->
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">关系可视化</h5>
                                    <div class="visualization-controls">
                                        <button class="btn btn-sm btn-outline-secondary" id="zoomInBtn" title="放大">
                                            <i class="bi bi-zoom-in"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" id="zoomOutBtn" title="缩小">
                                            <i class="bi bi-zoom-out"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" id="resetViewBtn" title="重置视图">
                                            <i class="bi bi-arrows-fullscreen"></i>
                                        </button>
                                        <div class="dropdown d-inline-block">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="layoutDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                布局
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="layoutDropdown">
                                                <li><a class="dropdown-item layout-option" data-layout="force" href="#">力导向布局</a></li>
                                                <li><a class="dropdown-item layout-option" data-layout="tree" href="#">树形布局</a></li>
                                                <li><a class="dropdown-item layout-option" data-layout="radial" href="#">放射状布局</a></li>
                                                <li><a class="dropdown-item layout-option" data-layout="hierarchical" href="#">层次布局</a></li>
                                            </ul>
                                        </div>
                                        <button class="btn btn-sm btn-outline-secondary" id="exportImageBtn" title="导出图像">
                                            <i class="bi bi-download"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="visualizationCanvas" class="visualization-canvas"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右侧：分析结果详情 -->
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">分析结果</h5>
                                </div>
                                <div class="card-body">
                                    <div id="analysisInfo" class="analysis-info">
                                        <div class="analysis-placeholder text-center py-5">
                                            <i class="bi bi-graph-up text-muted" style="font-size: 3rem;"></i>
                                            <p class="mt-3">选择知识点并运行分析<br>查看详细分析结果</p>
                                        </div>
                                        
                                        <div id="analysisDetails" class="analysis-details" style="display: none;">
                                            <div class="section-title">路径分析</div>
                                            
                                            <div class="result-summary mb-3">
                                                <div class="summary-item">
                                                    <span class="summary-label">路径长度:</span>
                                                    <span class="summary-value">5 步</span>
                                                </div>
                                                <div class="summary-item">
                                                    <span class="summary-label">平均难度:</span>
                                                    <span class="summary-value">中级</span>
                                                </div>
                                                <div class="summary-item">
                                                    <span class="summary-label">预计学习时间:</span>
                                                    <span class="summary-value">16 小时</span>
                                                </div>
                                            </div>
                                            
                                            <div class="path-steps">
                                                <div class="path-step">
                                                    <div class="step-number">1</div>
                                                    <div class="step-content">
                                                        <div class="step-title">数据处理基础</div>
                                                        <div class="step-info">基础 | 第二章</div>
                                                    </div>
                                                </div>
                                                <div class="path-step">
                                                    <div class="step-number">2</div>
                                                    <div class="step-content">
                                                        <div class="step-title">分布式计算原理</div>
                                                        <div class="step-info">中级 | 第四章</div>
                                                    </div>
                                                </div>
                                                <div class="path-step">
                                                    <div class="step-number">3</div>
                                                    <div class="step-content">
                                                        <div class="step-title">MapReduce模型</div>
                                                        <div class="step-info">中级 | 第四章</div>
                                                    </div>
                                                </div>
                                                <div class="path-step">
                                                    <div class="step-number">4</div>
                                                    <div class="step-content">
                                                        <div class="step-title">Hadoop生态系统</div>
                                                        <div class="step-info">中级 | 第四章</div>
                                                    </div>
                                                </div>
                                                <div class="path-step">
                                                    <div class="step-number">5</div>
                                                    <div class="step-content">
                                                        <div class="step-title">Spark框架</div>
                                                        <div class="step-info">高级 | 第四章</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="actions-row mt-3">
                                                <button class="btn btn-sm btn-primary" id="savePathBtn">
                                                    <i class="bi bi-bookmark-plus me-1"></i> 保存此路径
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" id="pathReportBtn">
                                                    <i class="bi bi-file-earmark-text me-1"></i> 生成报告
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 知识点关系统计 -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="mb-0">关系统计</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="relation-stats">
                                        <div class="stat-item">
                                            <div class="stat-label">关联密度</div>
                                            <div class="stat-value">0.62</div>
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-primary" role="progressbar" style="width: 62%;" aria-valuenow="62" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">中心度</div>
                                            <div class="stat-value">0.45</div>
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">重要性</div>
                                            <div class="stat-value">0.78</div>
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 78%;" aria-valuenow="78" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">相似度</div>
                                            <div class="stat-value">0.36</div>
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-info" role="progressbar" style="width: 36%;" aria-valuenow="36" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 知识点聚类分析 -->
                <div class="clustering-analysis mt-4">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">知识点聚类分析</h5>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="clusteringTypeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    聚类方式
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="clusteringTypeDropdown">
                                    <li><a class="dropdown-item clustering-option" data-type="topic" href="#">按主题聚类</a></li>
                                    <li><a class="dropdown-item clustering-option" data-type="difficulty" href="#">按难度聚类</a></li>
                                    <li><a class="dropdown-item clustering-option" data-type="chapter" href="#">按章节聚类</a></li>
                                    <li><a class="dropdown-item clustering-option" data-type="dependency" href="#">按依赖关系聚类</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div id="clusteringViz" class="clustering-visualization">
                                        <!-- 这里将通过JavaScript渲染聚类可视化 -->
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="cluster-info">
                                        <div class="cluster-list">
                                            <div class="cluster-item active">
                                                <div class="cluster-header" data-bs-toggle="collapse" data-bs-target="#cluster1">
                                                    <div class="cluster-title">
                                                        <div class="cluster-color" style="background-color: #4361ee;"></div>
                                                        <h6>基础概念</h6>
                                                    </div>
                                                    <span class="cluster-count">4 个知识点</span>
                                                </div>
                                                <div class="cluster-content collapse show" id="cluster1">
                                                    <div class="cluster-nodes">
                                                        <span>大数据概述</span>
                                                        <span>数据采集基础</span>
                                                        <span>分布式存储</span>
                                                        <span>数据处理</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="cluster-item">
                                                <div class="cluster-header" data-bs-toggle="collapse" data-bs-target="#cluster2">
                                                    <div class="cluster-title">
                                                        <div class="cluster-color" style="background-color: #f72585;"></div>
                                                        <h6>算法与优化</h6>
                                                    </div>
                                                    <span class="cluster-count">5 个知识点</span>
                                                </div>
                                                <div class="cluster-content collapse" id="cluster2">
                                                    <div class="cluster-nodes">
                                                        <span>MapReduce模型</span>
                                                        <span>分布式计算</span>
                                                        <span>数据质量管理</span>
                                                        <span>Hadoop框架</span>
                                                        <span>Spark框架</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="cluster-item">
                                                <div class="cluster-header" data-bs-toggle="collapse" data-bs-target="#cluster3">
                                                    <div class="cluster-title">
                                                        <div class="cluster-color" style="background-color: #4cc9f0;"></div>
                                                        <h6>数据可视化</h6>
                                                    </div>
                                                    <span class="cluster-count">5 个知识点</span>
                                                </div>
                                                <div class="cluster-content collapse" id="cluster3">
                                                    <div class="cluster-nodes">
                                                        <span>数据可视化</span>
                                                        <span>数据挖掘</span>
                                                        <span>ETL流程</span>
                                                        <span>数据湖</span>
                                                        <span>数据仓库</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="cluster-item">
                                                <div class="cluster-header" data-bs-toggle="collapse" data-bs-target="#cluster4">
                                                    <div class="cluster-title">
                                                        <div class="cluster-color" style="background-color: #4ade80;"></div>
                                                        <h6>应用案例</h6>
                                                    </div>
                                                    <span class="cluster-count">3 个知识点</span>
                                                </div>
                                                <div class="cluster-content collapse" id="cluster4">
                                                    <div class="cluster-nodes">
                                                        <span>数据挖掘</span>
                                                        <span>数据可视化</span>
                                                        <span>迁移学习</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 知识点浏览模态框 -->
    <div class="modal fade" id="nodeSelectModal" tabindex="-1" aria-labelledby="nodeSelectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="nodeSelectModalLabel">选择知识点</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="modal-search mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control border-start-0" id="nodeSearchInput" placeholder="搜索知识点...">
                        </div>
                    </div>
                    
                    <div class="node-tabs">
                        <ul class="nav nav-tabs" id="nodeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="popular-tab" data-bs-toggle="tab" data-bs-target="#popular" type="button" role="tab" aria-controls="popular" aria-selected="true">热门知识点</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="recent-tab" data-bs-toggle="tab" data-bs-target="#recent" type="button" role="tab" aria-controls="recent" aria-selected="false">最近学习</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="false">全部</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content p-3 border border-top-0 rounded-bottom" id="nodeTabsContent">
                            <div class="tab-pane fade show active" id="popular" role="tabpanel" aria-labelledby="popular-tab">
                                <div class="node-grid">
                                    <div class="node-card" data-node-id="1" data-node-name="神经网络">
                                        <div class="node-card-title">神经网络</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                    <div class="node-card" data-node-id="7" data-node-name="卷积神经网络">
                                        <div class="node-card-title">卷积神经网络</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="4" data-node-name="深度学习">
                                        <div class="node-card-title">深度学习</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                    <div class="node-card" data-node-id="6" data-node-name="反向传播">
                                        <div class="node-card-title">反向传播</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="9" data-node-name="图像识别">
                                        <div class="node-card-title">图像识别</div>
                                        <div class="node-card-type">应用案例</div>
                                    </div>
                                    <div class="node-card" data-node-id="2" data-node-name="机器学习">
                                        <div class="node-card-title">机器学习</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="recent" role="tabpanel" aria-labelledby="recent-tab">
                                <div class="node-grid">
                                    <div class="node-card" data-node-id="7" data-node-name="卷积神经网络">
                                        <div class="node-card-title">卷积神经网络</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="6" data-node-name="反向传播">
                                        <div class="node-card-title">反向传播</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="12" data-node-name="梯度下降">
                                        <div class="node-card-title">梯度下降</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="all" role="tabpanel" aria-labelledby="all-tab">
                                <div class="node-grid">
                                    <div class="node-card" data-node-id="1" data-node-name="神经网络">
                                        <div class="node-card-title">神经网络</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                    <div class="node-card" data-node-id="2" data-node-name="机器学习">
                                        <div class="node-card-title">机器学习</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                    <div class="node-card" data-node-id="3" data-node-name="感知器">
                                        <div class="node-card-title">感知器</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="4" data-node-name="深度学习">
                                        <div class="node-card-title">深度学习</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                    <div class="node-card" data-node-id="5" data-node-name="人工智能">
                                        <div class="node-card-title">人工智能</div>
                                        <div class="node-card-type">基础概念</div>
                                    </div>
                                    <div class="node-card" data-node-id="6" data-node-name="反向传播">
                                        <div class="node-card-title">反向传播</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="7" data-node-name="卷积神经网络">
                                        <div class="node-card-title">卷积神经网络</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                    <div class="node-card" data-node-id="8" data-node-name="递归神经网络">
                                        <div class="node-card-title">递归神经网络</div>
                                        <div class="node-card-type">技术原理</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="selectNodeBtn">选择</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI 助手聊天界面 -->
    <div class="ai-assistant-panel" id="aiAssistantPanel" style="display: none; position: fixed; right: 0; top: 0; width: 350px; height: 100vh; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); z-index: 1050; overflow: hidden; transition: all 0.3s ease;">
        <div class="d-flex flex-column h-100">
            <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <div class="me-2 p-2 rounded-circle bg-primary bg-opacity-10">
                        <i class="bi bi-robot text-primary"></i>
                    </div>
                    <h5 class="mb-0">AI 学习助手</h5>
                </div>
                <button class="btn-close" id="closeAiAssistant"></button>
            </div>
            
            <div class="p-3 flex-grow-1 overflow-auto" id="chatMessages" style="background-color: #f8f9fa;">
                <div class="chat-message ai-message mb-3">
                    <div class="message-content p-3 rounded">
                        <p class="mb-0">你好！我是你的 AI 学习助手。需要我帮你分析哪些知识点之间的关系？</p>
                    </div>
                    <small class="text-muted">今天 10:00</small>
                </div>
            </div>
            
            <div class="p-3 border-top">
                <div class="input-group">
                    <input type="text" class="form-control" id="chatInput" placeholder="输入你的问题...">
                    <button class="btn btn-primary" id="sendMessageBtn">
                        <i class="bi bi-send"></i>
                    </button>
                </div>
                <div class="d-flex justify-content-around mt-2">
                    <button class="btn btn-sm btn-light" id="suggestionBtn1">最短学习路径</button>
                    <button class="btn btn-sm btn-light" id="suggestionBtn2">相关知识点</button>
                    <button class="btn btn-sm btn-light" id="suggestionBtn3">知识结构</button>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/webjars/jquery/3.7.1/jquery.min.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <script>
        // 初始化AOS动画库
        AOS.init({
            duration: 800,
            once: true
        });
        
        $(document).ready(function() {
            // 侧边栏切换功能
            $('#toggle-sidebar').on('click', function() {
                $('#sidebar').toggleClass('collapsed');
                $('#main-content').toggleClass('expanded');
            });
            
            $('#close-sidebar').on('click', function() {
                $('#sidebar').addClass('collapsed');
                $('#main-content').addClass('expanded');
            });
            
            // 用户下拉菜单功能
            $('#profileLink, #settingsLink, #helpLink').on('click', function(e) {
                e.preventDefault();
                const href = $(this).attr('href');
                window.location.href = href;
            });
            
            // AI助手功能
            $('#aiAssistantBtn').on('click', function() {
                $('#aiAssistantPanel').toggle();
            });
            
            $('#closeAiAssistant').on('click', function() {
                $('#aiAssistantPanel').hide();
            });
            
            $('#sendMessageBtn').on('click', sendMessage);
            
            $('#chatInput').on('keypress', function(e) {
                if (e.which === 13) {
                    sendMessage();
                }
            });
            
            $('.btn-light').on('click', function() {
                const suggestion = $(this).text();
                $('#chatInput').val(suggestion);
                sendMessage();
            });
            
            function sendMessage() {
                const messageText = $('#chatInput').val().trim();
                if (messageText === '') return;
                
                // 添加用户消息
                const userMessageHtml = `
                    <div class="chat-message user-message mb-3 text-end">
                        <div class="message-content p-3 rounded bg-primary text-white">
                            <p class="mb-0">${messageText}</p>
                        </div>
                        <small class="text-muted">刚刚</small>
                    </div>
                `;
                $('#chatMessages').append(userMessageHtml);
                
                // 清空输入框
                $('#chatInput').val('');
                
                // 滚动到底部
                $('#chatMessages').scrollTop($('#chatMessages')[0].scrollHeight);
                
                // 模拟AI响应
                setTimeout(function() {
                    let aiResponse = '';
                    
                    if (messageText.includes('路径') || messageText.includes('最短')) {
                        aiResponse = '要找到两个知识点之间的最短学习路径：<br>1. 在分析类型中选择"路径分析"<br>2. 设置起始和目标知识点<br>3. 点击"开始分析"<br><br>系统会自动计算出最优学习路径，包括中间必要的知识点和学习建议。';
                    } else if (messageText.includes('相关') || messageText.includes('关联')) {
                        aiResponse = '要探索与特定知识点相关的内容：<br>1. 在分析类型中选择"关联知识点分析"<br>2. 选择目标知识点<br>3. 设置分析深度<br><br>分析结果会展示相关知识点并按关联度排序，帮助你拓展学习范围。';
                    } else if (messageText.includes('结构') || messageText.includes('依赖')) {
                        aiResponse = '了解知识点的结构和依赖关系可以：<br>1. 在分析类型中选择"依赖关系分析"<br>2. 选择目标知识点<br>3. 调整关系类型筛选<br><br>系统会生成一个以该知识点为中心的结构图，显示它的前置和后续知识点，帮助你理解整体学习脉络。';
                    } else {
                        aiResponse = '关于"' + messageText + '"的分析，你可以使用本页面的功能来探索知识点之间的关系。选择适当的分析类型和参数，系统会生成可视化结果和详细分析。需要更具体的帮助可以告诉我。';
                    }
                    
                    const aiMessageHtml = `
                        <div class="chat-message ai-message mb-3">
                            <div class="message-content p-3 rounded">
                                <p class="mb-0">${aiResponse}</p>
                            </div>
                            <small class="text-muted">刚刚</small>
                        </div>
                    `;
                    $('#chatMessages').append(aiMessageHtml);
                    
                    // 滚动到底部
                    $('#chatMessages').scrollTop($('#chatMessages')[0].scrollHeight);
                }, 1000);
            }
            
            // 分析类型切换
            $('#analysisType').on('change', function() {
                const type = $(this).val();
                
                // 根据分析类型显示/隐藏相关字段
                if (type === 'path') {
                    $('.path-analysis-field').show();
                } else {
                    $('.path-analysis-field').hide();
                }
                
                // 重置表单
                $('#resetBtn').trigger('click');
            });
            
            // 深度滑块更新
            $('#analysisDepth').on('input', function() {
                $('.range-value').text($(this).val());
            });
            
            // 知识点浏览
            $('#browseStartBtn, #browseEndBtn').on('click', function() {
                const targetInput = $(this).attr('id') === 'browseStartBtn' ? 'startNode' : 'endNode';
                $('#nodeSelectModal').data('target', targetInput).modal('show');
            });
            
            // 选择知识点
            $('.node-card').on('click', function() {
                $('.node-card').removeClass('selected');
                $(this).addClass('selected');
            });
            
            $('#selectNodeBtn').on('click', function() {
                const selectedNode = $('.node-card.selected');
                if (selectedNode.length > 0) {
                    const targetInput = $('#nodeSelectModal').data('target');
                    const nodeName = selectedNode.data('node-name');
                    $('#' + targetInput).val(nodeName);
                }
                $('#nodeSelectModal').modal('hide');
            });
            
            // 节点搜索
            $('#nodeSearchInput').on('keyup', function() {
                const searchTerm = $(this).val().toLowerCase();
                $('.node-card').each(function() {
                    const nodeName = $(this).data('node-name').toLowerCase();
                    if (nodeName.includes(searchTerm)) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
            
            // 重置按钮
            $('#resetBtn').on('click', function() {
                $('#startNode, #endNode').val('');
                $('#analysisDepth').val(3);
                $('.range-value').text('3');
                $('.form-check-input').prop('checked', true);
                $('#maxPathLength').val('3');
            });
            
            // 开始分析
            $('#analyzeBtn').on('click', function() {
                const startNode = $('#startNode').val().trim();
                const endNode = $('#endNode').val().trim();
                const analysisType = $('#analysisType').val();
                
                if (analysisType === 'path' && (startNode === '' || endNode === '')) {
                    alert('请选择起始和目标知识点');
                    return;
                } else if (startNode === '') {
                    alert('请选择起始知识点');
                    return;
                }
                
                // 显示加载状态
                $(this).html('<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>分析中...');
                $(this).prop('disabled', true);
                
                // 隐藏初始状态，准备显示结果
                $('#initialAnalysis').fadeOut();
                
                // 模拟分析过程
                setTimeout(function() {
                    // 显示分析结果
                    $('#analysisResults').removeClass('d-none').hide().fadeIn();
                    
                    // 恢复按钮状态
                    $('#analyzeBtn').html('<i class="bi bi-lightning-charge me-1"></i>开始分析');
                    $('#analyzeBtn').prop('disabled', false);
                    
                    // 初始化关系图
                    initVisualization();
                    
                    // 初始化关系强度图表
                    initRelationshipChart();
                    
                    // 滚动到结果区域
                    $('html, body').animate({
                        scrollTop: $('#analysisResults').offset().top - 100
                    }, 500);
                    
                    // 重新初始化AOS动画
                    AOS.refresh();
                }, 2000);
            });
            
            // 路径选择器
            $('.path-option').on('click', function() {
                $('.path-option').removeClass('active');
                $(this).addClass('active');
                
                // 更新可视化
                updatePathVisualization($(this).data('path'));
            });
            
            // 视图切换
            $('.viz-view-btn').on('click', function() {
                $('.viz-view-btn').removeClass('active');
                $(this).addClass('active');
                
                const viewType = $(this).data('view');
                updateVisualizationView(viewType);
            });
            
            // 初始化关系可视化
            function initVisualization() {
                const width = document.getElementById('visualizationCanvas').clientWidth;
                const height = 600;
                
                // 创建SVG
                const svg = d3.select('#visualizationCanvas')
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height);
                
                // 添加提示文本
                svg.append('text')
                    .attr('x', width/2)
                    .attr('y', height/2)
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'middle')
                    .style('font-size', '18px')
                    .style('fill', '#adb5bd')
                    .text('选择知识点并运行分析以查看可视化结果');
                
                // 保存引用
                window.analysisViz = {
                    svg: svg,
                    width: width,
                    height: height,
                    simulation: null,
                    nodes: [],
                    links: []
                };
            }
            
            // 更新路径可视化
            function updatePathVisualization(pathId) {
                const edges = window.analysisViz.links;
                
                // 重置所有边
                edges.forEach(edge => {
                    edge.color = '#6c757d';
                    edge.width = 1;
                    edge.hidden = true;
                });
                
                // 根据选择的路径更新边
                if (pathId === 2) {
                    // 显示概念详细路径
                    edges.find(e => e.id === "e4").hidden = false;
                    edges.find(e => e.id === "e7").hidden = false;
                    edges.find(e => e.id === "e4").color = '#f72585';
                    edges.find(e => e.id === "e7").color = '#f72585';
                    edges.find(e => e.id === "e4").width = 3;
                    edges.find(e => e.id === "e7").width = 3;
                } else if (pathId === 3) {
                    // 显示应用导向路径
                    edges.find(e => e.id === "e3").hidden = false;
                    edges.find(e => e.id === "e5").hidden = false;
                    edges.find(e => e.id === "e3").color = '#f72585';
                    edges.find(e => e.id === "e5").color = '#f72585';
                    edges.find(e => e.id === "e3").width = 3;
                    edges.find(e => e.id === "e5").width = 3;
                }
                
                // 更新可视化
                window.analysisViz.svg.selectAll("line").attr("stroke", d => d.color).attr("stroke-width", d => d.width);
                window.analysisViz.svg.selectAll("text").style("fill", "#495057");
                window.analysisViz.svg.selectAll("circle").attr("fill", d => d.color);
                window.analysisViz.svg.selectAll("title").text(d => `${d.name}\n分类: ${d.group}\n难度: ${d.level}\n章节: ${d.chapter}`);
                
                // 重新适应屏幕
                window.analysisViz.svg.attr("width", window.analysisViz.width).attr("height", window.analysisViz.height);
            }
            
            // 更新可视化视图
            function updateVisualizationView(viewType) {
                if (viewType === 'tree') {
                    // 树形视图配置
                    window.analysisViz.svg.selectAll("g").attr("transform", "translate(0,0) scale(1)");
                } else {
                    // 普通图视图配置
                    window.analysisViz.svg.selectAll("g").attr("transform", "translate(0,0) scale(1)");
                }
                
                // 重新适应屏幕
                window.analysisViz.svg.attr("width", window.analysisViz.width).attr("height", window.analysisViz.height);
            }
            
            // 初始化关系强度图表
            function initRelationshipChart() {
                const ctx = document.getElementById('relationshipStrengthChart').getContext('2d');
                
                const chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['概念理解', '应用能力', '技术掌握', '关联广度', '学习难度'],
                        datasets: [{
                            label: '神经网络',
                            data: [85, 70, 75, 90, 60],
                            backgroundColor: 'rgba(67, 97, 238, 0.2)',
                            borderColor: 'rgba(67, 97, 238, 1)',
                            pointBackgroundColor: 'rgba(67, 97, 238, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(67, 97, 238, 1)'
                        }, {
                            label: '卷积神经网络',
                            data: [70, 90, 80, 75, 85],
                            backgroundColor: 'rgba(76, 201, 240, 0.2)',
                            borderColor: 'rgba(76, 201, 240, 1)',
                            pointBackgroundColor: 'rgba(76, 201, 240, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(76, 201, 240, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        elements: {
                            line: {
                                tension: 0.1
                            }
                        },
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 100
                            }
                        }
                    }
                });
            }
            
            // 可视化控制按钮功能
            $('.viz-control-btn').on('click', function() {
                const action = $(this).attr('title');
                
                switch(action) {
                    case '放大':
                        window.analysisViz.svg.selectAll("g").attr("transform", "translate(0,0) scale(1.2)");
                        break;
                    case '缩小':
                        window.analysisViz.svg.selectAll("g").attr("transform", "translate(0,0) scale(0.8)");
                        break;
                    case '适应屏幕':
                        window.analysisViz.svg.attr("width", window.analysisViz.width).attr("height", window.analysisViz.height);
                        break;
                    case '重置视图':
                        initVisualization();
                        $('.path-option[data-path="1"]').click();
                        break;
                }
            });
            
            // 导出和分享按钮
            $('#exportBtn').on('click', function() {
                alert('分析结果将导出为PDF文件');
            });
            
            $('#shareBtn').on('click', function() {
                alert('分享链接已复制到剪贴板');
            });
            
            // 初始化D3.js可视化
            initVisualization();
            
            // 初始化聚类可视化
            initClusteringViz();
            
            // 运行分析按钮点击事件
            $('#runAnalysisBtn').on('click', function() {
                const startNode = $('#startNode').val();
                const endNode = $('#endNode').val();
                const analysisType = $('#analysisType').val();
                
                if (!startNode || !endNode) {
                    alert('请选择起始和目标知识点');
                    return;
                }
                
                // 显示分析结果详情
                $('#analysisDetails').show();
                $('.analysis-placeholder').hide();
                
                // 更新可视化
                updateVisualization(startNode, endNode, analysisType);
            });
            
            // 可视化控制按钮
            $('#zoomInBtn').on('click', function() {
                zoomVisualization(1.2);
            });
            
            $('#zoomOutBtn').on('click', function() {
                zoomVisualization(0.8);
            });
            
            $('#resetViewBtn').on('click', function() {
                resetVisualization();
            });
            
            // 布局选项
            $('.layout-option').on('click', function(e) {
                e.preventDefault();
                const layout = $(this).data('layout');
                changeLayout(layout);
            });
            
            // 聚类选项
            $('.clustering-option').on('click', function(e) {
                e.preventDefault();
                const type = $(this).data('type');
                updateClustering(type);
            });
            
            // 保存路径和报告按钮
            $('#savePathBtn').on('click', function() {
                saveCurrentPath();
            });
            
            $('#pathReportBtn').on('click', function() {
                generatePathReport();
            });
        });
        
        // 缩放可视化
        function zoomVisualization(scale) {
            if (!window.analysisViz || !window.analysisViz.svg) return;
            
            // 创建缩放行为
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on("zoom", (event) => {
                    window.analysisViz.svg.selectAll("g")
                        .attr("transform", event.transform);
                });
            
            // 应用缩放
            if (scale > 1) {
                window.analysisViz.svg.transition()
                    .duration(300)
                    .call(zoom.scaleBy, scale);
            } else {
                window.analysisViz.svg.transition()
                    .duration(300)
                    .call(zoom.scaleBy, scale);
            }
        }
        
        // 重置可视化
        function resetVisualization() {
            if (!window.analysisViz || !window.analysisViz.svg) return;
            
            // 创建缩放行为
            const zoom = d3.zoom()
                .on("zoom", (event) => {
                    window.analysisViz.svg.selectAll("g")
                        .attr("transform", event.transform);
                });
            
            // 重置缩放和平移
            window.analysisViz.svg.transition()
                .duration(500)
                .call(zoom.transform, d3.zoomIdentity);
            
            // 重启模拟器
            if (window.analysisViz.simulation) {
                window.analysisViz.simulation.alpha(0.3).restart();
            }
        }
        
        // 更改布局
        function changeLayout(layout) {
            if (!window.analysisViz || !window.analysisViz.simulation) return;
            
            const simulation = window.analysisViz.simulation;
            const width = window.analysisViz.width;
            const height = window.analysisViz.height;
            
            // 移除当前的力
            simulation.force("link", null)
                     .force("charge", null)
                     .force("center", null)
                     .force("x", null)
                     .force("y", null);
            
            // 根据选择的布局应用不同的力
            if (layout === "force") {
                // 力导向布局
                simulation.force("link", d3.forceLink(window.analysisViz.links).id(d => d.id).distance(150))
                         .force("charge", d3.forceManyBody().strength(-500))
                         .force("center", d3.forceCenter(width / 2, height / 2));
            } else if (layout === "tree") {
                // 树形布局
                simulation.force("link", d3.forceLink(window.analysisViz.links).id(d => d.id).distance(100))
                         .force("charge", d3.forceManyBody().strength(-1000))
                         .force("x", d3.forceX(d => {
                             if (d.id === "node4") return width * 0.1;
                             if (d.id === "node9") return width * 0.9;
                             return width * 0.5;
                         }).strength(0.5))
                         .force("y", d3.forceY(height / 2).strength(0.1));
            } else if (layout === "radial") {
                // 放射状布局
                simulation.force("link", d3.forceLink(window.analysisViz.links).id(d => d.id).distance(100))
                         .force("charge", d3.forceManyBody().strength(-800));
                
                // 添加径向力 (D3 v7中不直接提供forceRadial，这里模拟径向力)
                const cx = width / 2;
                const cy = height / 2;
                const radius = 150;
                
                simulation.force("radial", d3.forceRadial(radius, cx, cy));
            } else if (layout === "hierarchical") {
                // 层次布局
                simulation.force("link", d3.forceLink(window.analysisViz.links).id(d => d.id).distance(120))
                         .force("charge", d3.forceManyBody().strength(-500))
                         .force("x", d3.forceX(d => {
                             // 根据节点在路径中的位置确定x坐标
                             const nodeIds = ["node4", "node7", "node8", "node10", "node9"];
                             const index = nodeIds.indexOf(d.id);
                             return 100 + (index * (width - 200) / (nodeIds.length - 1));
                         }).strength(1))
                         .force("y", d3.forceY(height / 2).strength(0.5));
            }
            
            // 重启模拟器
            simulation.alpha(0.3).restart();
        }
        
        // 初始化聚类可视化
        function initClusteringViz() {
            const width = document.getElementById('clusteringViz').clientWidth;
            const height = 400;
            
            // 创建SVG
            const svg = d3.select('#clusteringViz')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // 添加提示文本
            svg.append('text')
                .attr('x', width/2)
                .attr('y', height/2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .style('font-size', '16px')
                .style('fill', '#adb5bd')
                .text('选择知识点并运行分析以查看聚类结果');
        }
        
        // 更新聚类可视化
        function updateClustering(type) {
            // 在实际应用中，这里会重新请求后端数据，并更新可视化
            
            // 为了演示，简单更新提示信息
            $('#clusteringViz svg').remove();
            
            const width = document.getElementById('clusteringViz').clientWidth;
            const height = 400;
            
            // 创建SVG
            const svg = d3.select('#clusteringViz')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // 添加提示文本
            svg.append('text')
                .attr('x', width/2)
                .attr('y', height/2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .style('font-size', '16px')
                .style('fill', '#495057')
                .text(`${type === 'topic' ? '按主题' : type === 'difficulty' ? '按难度' : type === 'chapter' ? '按章节' : '按依赖关系'}聚类分析结果将在这里显示`);
        }
        
        // 保存当前路径
        function saveCurrentPath() {
            // 在实际应用中，这里会向后端发送请求保存路径
            
            // 显示成功消息
            alert('学习路径已保存！可在个人中心-"我的学习路径"中查看。');
        }
        
        // 生成路径报告
        function generatePathReport() {
            // 显示加载提示
            alert('分析报告生成中...');
            
            // 模拟报告生成延迟
            setTimeout(() => {
                // 在实际应用中，这里会向后端发送请求生成报告，然后下载或显示结果
                alert('报告已生成并下载');
            }, 1500);
        }
    </script>
</body>
</html> 